(function(f,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(f=typeof globalThis<"u"?globalThis:f||self,g(f.flyoNitroIntegration={}))})(this,function(f){"use strict";const g="https://api.flyo.cloud/nitro/v1".replace(/\/+$/,"");class K{constructor(t={}){this.configuration=t}set config(t){this.configuration=t}get basePath(){return this.configuration.basePath!=null?this.configuration.basePath:g}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||E}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const t=this.configuration.apiKey;if(t)return typeof t=="function"?t:()=>t}get accessToken(){const t=this.configuration.accessToken;if(t)return typeof t=="function"?t:async()=>t}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}}const N=new K,q=class x{constructor(t=N){this.configuration=t,this.fetchApi=async(i,o)=>{let a={url:i,init:o};for(const s of this.middleware)s.pre&&(a=await s.pre({fetch:this.fetchApi,...a})||a);let r;try{r=await(this.configuration.fetchApi||fetch)(a.url,a.init)}catch(s){for(const u of this.middleware)u.onError&&(r=await u.onError({fetch:this.fetchApi,url:a.url,init:a.init,error:s,response:r?r.clone():void 0})||r);if(r===void 0)throw s instanceof Error?new F(s,"The request failed and the interceptors did not return an alternative response"):s}for(const s of this.middleware)s.post&&(r=await s.post({fetch:this.fetchApi,url:a.url,init:a.init,response:r.clone()})||r);return r},this.middleware=t.middleware}withMiddleware(...t){const i=this.clone();return i.middleware=i.middleware.concat(...t),i}withPreMiddleware(...t){const i=t.map(o=>({pre:o}));return this.withMiddleware(...i)}withPostMiddleware(...t){const i=t.map(o=>({post:o}));return this.withMiddleware(...i)}isJsonMime(t){return t?x.jsonRegex.test(t):!1}async request(t,i){const{url:o,init:a}=await this.createFetchParams(t,i),r=await this.fetchApi(o,a);if(r&&r.status>=200&&r.status<300)return r;throw new B(r,"Response returned an error code")}async createFetchParams(t,i){let o=this.configuration.basePath+t.path;t.query!==void 0&&Object.keys(t.query).length!==0&&(o+="?"+this.configuration.queryParamsStringify(t.query));const a=Object.assign({},this.configuration.headers,t.headers);Object.keys(a).forEach(v=>a[v]===void 0?delete a[v]:{});const r=typeof i=="function"?i:async()=>i,s={method:t.method,headers:a,body:t.body,credentials:this.configuration.credentials},u={...s,...await r({init:s,context:t})};let c;$(u.body)||u.body instanceof URLSearchParams||O(u.body)?c=u.body:this.isJsonMime(a["Content-Type"])?c=JSON.stringify(u.body):c=u.body;const d={...u,body:c};return{url:o,init:d}}clone(){const t=this.constructor,i=new t(this.configuration);return i.middleware=this.middleware.slice(),i}};q.jsonRegex=new RegExp("^(:?application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(:?;.*)?$","i");let h=q;function O(e){return typeof Blob<"u"&&e instanceof Blob}function $(e){return typeof FormData<"u"&&e instanceof FormData}class B extends Error{constructor(t,i){super(i),this.response=t,this.name="ResponseError"}}class F extends Error{constructor(t,i){super(i),this.cause=t,this.name="FetchError"}}class m extends Error{constructor(t,i){super(i),this.field=t,this.name="RequiredError"}}function n(e,t){return e[t]!=null}function E(e,t=""){return Object.keys(e).map(i=>R(i,e[i],t)).filter(i=>i.length>0).join("&")}function R(e,t,i=""){const o=i+(i.length?`[${e}]`:e);if(t instanceof Array){const a=t.map(r=>encodeURIComponent(String(r))).join(`&${encodeURIComponent(o)}=`);return`${encodeURIComponent(o)}=${a}`}if(t instanceof Set){const a=Array.from(t);return R(e,a,i)}return t instanceof Date?`${encodeURIComponent(o)}=${encodeURIComponent(t.toISOString())}`:t instanceof Object?E(t,o):`${encodeURIComponent(o)}=${encodeURIComponent(String(t))}`}function w(e,t){return Object.keys(e).reduce((i,o)=>({...i,[o]:t(e[o])}),{})}class p{constructor(t,i=o=>o){this.raw=t,this.transformer=i}async value(){return this.transformer(await this.raw.json())}}function M(e){return D(e)}function D(e,t){return e==null?e:{identifier:n(e,"identifier")?e.identifier:void 0,content:n(e,"content")?e.content.map(C):void 0}}function C(e){return G(e)}function G(e,t){return e==null?e:{items:n(e,"items")?e.items:void 0,content:n(e,"content")?e.content:void 0,config:n(e,"config")?e.config:void 0,identifier:n(e,"identifier")?e.identifier:void 0,uid:n(e,"uid")?e.uid:void 0,component:n(e,"component")?e.component:void 0,slots:n(e,"slots")?w(e.slots,M):void 0}}function A(e){return J(e)}function J(e,t){return e==null?e:{type:n(e,"type")?e.type:void 0,target:n(e,"target")?e.target:void 0,label:n(e,"label")?e.label:void 0,href:n(e,"href")?e.href:void 0,slug:n(e,"slug")?e.slug:void 0,properties:n(e,"properties")?e.properties:void 0,children:n(e,"children")?e.children.map(A):void 0}}function V(e){return W(e)}function W(e,t){return e==null?e:{items:n(e,"items")?e.items.map(A):void 0,uid:n(e,"uid")?e.uid:void 0,identifier:n(e,"identifier")?e.identifier:void 0,label:n(e,"label")?e.label:void 0}}function z(e){return Q(e)}function Q(e,t){return e==null?e:{domain:n(e,"domain")?e.domain:void 0,slug:n(e,"slug")?e.slug:void 0,version:n(e,"version")?e.version:void 0,updated_at:n(e,"updated_at")?e.updated_at:void 0,language:n(e,"language")?e.language:void 0}}function H(e){return X(e)}function X(e,t){return e==null?e:{nitro:n(e,"nitro")?z(e.nitro):void 0,pages:n(e,"pages")?e.pages:void 0,containers:n(e,"containers")?w(e.containers,V):void 0,globals:n(e,"globals")?e.globals:void 0}}function Z(e){return Y(e)}function Y(e,t){return e==null?e:{api:n(e,"api")?e.api:void 0,image:n(e,"image")?e.image:void 0}}function ee(e){return te(e)}function te(e,t){return e==null?e:{_version:n(e,"_version")?e._version:void 0,entity_metric:n(e,"entity_metric")?Z(e.entity_metric):void 0,entity_unique_id:n(e,"entity_unique_id")?e.entity_unique_id:void 0,entity_id:n(e,"entity_id")?e.entity_id:void 0,entity_image:n(e,"entity_image")?e.entity_image:void 0,entity_slug:n(e,"entity_slug")?e.entity_slug:void 0,entity_teaser:n(e,"entity_teaser")?e.entity_teaser:void 0,entity_time_end:n(e,"entity_time_end")?e.entity_time_end:void 0,entity_time_start:n(e,"entity_time_start")?e.entity_time_start:void 0,entity_title:n(e,"entity_title")?e.entity_title:void 0,entity_type:n(e,"entity_type")?e.entity_type:void 0,entity_type_id:n(e,"entity_type_id")?e.entity_type_id:void 0,updated_at:n(e,"updated_at")?e.updated_at:void 0,routes:n(e,"routes")?e.routes:void 0}}function k(e){return ie(e)}function ie(e,t){return e==null?e:{entity:n(e,"entity")?ee(e.entity):void 0,model:n(e,"model")?e.model:void 0,language:n(e,"language")?e.language:void 0,jsonld:n(e,"jsonld")?e.jsonld:void 0}}function I(e){return ne(e)}function ne(e,t){return e==null?e:{entity_unique_id:n(e,"entity_unique_id")?e.entity_unique_id:void 0,entity_title:n(e,"entity_title")?e.entity_title:void 0,entity_teaser:n(e,"entity_teaser")?e.entity_teaser:void 0,entity_slug:n(e,"entity_slug")?e.entity_slug:void 0,entity_time_start:n(e,"entity_time_start")?e.entity_time_start:void 0,entity_type:n(e,"entity_type")?e.entity_type:void 0,entity_type_id:n(e,"entity_type_id")?e.entity_type_id:void 0,entity_image:n(e,"entity_image")?e.entity_image:void 0,routes:n(e,"routes")?e.routes:void 0}}function oe(e){return re(e)}function re(e,t){return e==null?e:{description:n(e,"description")?e.description:void 0,image:n(e,"image")?e.image:void 0,title:n(e,"title")?e.title:void 0}}function ae(e){return se(e)}function se(e,t){return e==null?e:{slug:n(e,"slug")?e.slug:void 0,title:n(e,"title")?e.title:void 0}}function ue(e){return ce(e)}function ce(e,t){return e==null?e:{value:n(e,"value")?e.value:void 0,navigation:n(e,"navigation")?e.navigation:void 0,propagate:n(e,"propagate")?e.propagate:void 0}}function S(e){return le(e)}function le(e,t){return e==null?e:{id:n(e,"id")?e.id:void 0,title:n(e,"title")?e.title:void 0,href:n(e,"href")?e.href:void 0,slug:n(e,"slug")?e.slug:void 0,json:n(e,"json")?e.json.map(C):void 0,depth:n(e,"depth")?e.depth:void 0,is_home:n(e,"is_home")?e.is_home:void 0,created_at:n(e,"created_at")?e.created_at:void 0,updated_at:n(e,"updated_at")?e.updated_at:void 0,is_visible:n(e,"is_visible")?e.is_visible:void 0,meta_json:n(e,"meta_json")?oe(e.meta_json):void 0,properties:n(e,"properties")?w(e.properties,ue):void 0,uid:n(e,"uid")?e.uid:void 0,type:n(e,"type")?e.type:void 0,target:n(e,"target")?e.target:void 0,container:n(e,"container")?e.container:void 0,breadcrumb:n(e,"breadcrumb")?e.breadcrumb.map(ae):void 0}}function de(e){return fe(e)}function fe(e,t){return e==null?e:{version:n(e,"version")?e.version:void 0,updated_at:n(e,"updated_at")?e.updated_at:void 0}}class pe extends h{async configRaw(t){const i={},o={};this.configuration&&this.configuration.apiKey&&(i.token=this.configuration.apiKey("token"));const a=await this.request({path:"/config",method:"GET",headers:o,query:i},t);return new p(a,r=>H(r))}async config(t){return await(await this.configRaw(t)).value()}}class ye extends h{async entityBySlugRaw(t,i){if(t.slug===null||t.slug===void 0)throw new m("slug","Required parameter requestParameters.slug was null or undefined when calling entityBySlug.");const o={};t.typeId!==void 0&&(o.typeId=t.typeId);const a={};this.configuration&&this.configuration.apiKey&&(o.token=this.configuration.apiKey("token"));const r=await this.request({path:"/entities/slug/{slug}".replace("{slug}",encodeURIComponent(String(t.slug))),method:"GET",headers:a,query:o},i);return new p(r,s=>k(s))}async entityBySlug(t,i){return await(await this.entityBySlugRaw(t,i)).value()}async entityByUniqueidRaw(t,i){if(t.uniqueid===null||t.uniqueid===void 0)throw new m("uniqueid","Required parameter requestParameters.uniqueid was null or undefined when calling entityByUniqueid.");const o={},a={};this.configuration&&this.configuration.apiKey&&(o.token=this.configuration.apiKey("token"));const r=await this.request({path:"/entities/uniqueid/{uniqueid}".replace("{uniqueid}",encodeURIComponent(String(t.uniqueid))),method:"GET",headers:a,query:o},i);return new p(r,s=>k(s))}async entityByUniqueid(t,i){return await(await this.entityByUniqueidRaw(t,i)).value()}}class he extends h{async homeRaw(t){const i={},o={};this.configuration&&this.configuration.apiKey&&(i.token=this.configuration.apiKey("token"));const a=await this.request({path:"/pages/home",method:"GET",headers:o,query:i},t);return new p(a,r=>S(r))}async home(t){return await(await this.homeRaw(t)).value()}async pageRaw(t,i){const o={};t.slug!==void 0&&(o.slug=t.slug);const a={};this.configuration&&this.configuration.apiKey&&(o.token=this.configuration.apiKey("token"));const r=await this.request({path:"/pages",method:"GET",headers:a,query:o},i);return new p(r,s=>S(s))}async page(t={},i){return await(await this.pageRaw(t,i)).value()}}class ge extends h{async searchRaw(t,i){if(t.query===null||t.query===void 0)throw new m("query","Required parameter requestParameters.query was null or undefined when calling search.");const o={};t.query!==void 0&&(o.query=t.query);const a={};this.configuration&&this.configuration.apiKey&&(o.token=this.configuration.apiKey("token"));const r=await this.request({path:"/search",method:"GET",headers:a,query:o},i);return new p(r,s=>s.map(I))}async search(t,i){return await(await this.searchRaw(t,i)).value()}}class ve extends h{async sitemapRaw(t){const i={},o={};this.configuration&&this.configuration.apiKey&&(i.token=this.configuration.apiKey("token"));const a=await this.request({path:"/sitemap",method:"GET",headers:o,query:i},t);return new p(a,r=>r.map(I))}async sitemap(t){return await(await this.sitemapRaw(t)).value()}}class me extends h{async versionRaw(t){const i={},o={};this.configuration&&this.configuration.apiKey&&(i.token=this.configuration.apiKey("token"));const a=await this.request({path:"/version",method:"GET",headers:o,query:i},t);return new p(a,r=>de(r))}async version(t){return await(await this.versionRaw(t)).value()}}const we=/[\p{Lu}]/u,_e=/[\p{Ll}]/u,T=/^[\p{Lu}](?![\p{Lu}])/gu,j=/([\p{Alpha}\p{N}_]|$)/u,_=/[_.\- ]+/,be=new RegExp("^"+_.source),P=new RegExp(_.source+j.source,"gu"),U=new RegExp("\\d+"+j.source,"gu"),qe=(e,t,i,o)=>{let a=!1,r=!1,s=!1,u=!1;for(let c=0;c<e.length;c++){const d=e[c];u=c>2?e[c-3]==="-":!0,a&&we.test(d)?(e=e.slice(0,c)+"-"+e.slice(c),a=!1,s=r,r=!0,c++):r&&s&&_e.test(d)&&(!u||o)?(e=e.slice(0,c-1)+"-"+e.slice(c-1),s=r,r=!1,a=!0):(a=t(d)===d&&i(d)!==d,s=r,r=i(d)===d&&t(d)!==d)}return e},Ee=(e,t)=>(T.lastIndex=0,e.replace(T,i=>t(i))),Re=(e,t)=>(P.lastIndex=0,U.lastIndex=0,e.replace(P,(i,o)=>t(o)).replace(U,i=>t(i)));function Ce(e,t){if(!(typeof e=="string"||Array.isArray(e)))throw new TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},Array.isArray(e)?e=e.map(r=>r.trim()).filter(r=>r.length).join("-"):e=e.trim(),e.length===0)return"";const i=t.locale===!1?r=>r.toLowerCase():r=>r.toLocaleLowerCase(t.locale),o=t.locale===!1?r=>r.toUpperCase():r=>r.toLocaleUpperCase(t.locale);return e.length===1?_.test(e)?"":t.pascalCase?o(e):i(e):(e!==i(e)&&(e=qe(e,i,o,t.preserveConsecutiveUppercase)),e=e.replace(be,""),e=t.preserveConsecutiveUppercase?Ee(e,i):i(e),t.pascalCase&&(e=o(e.charAt(0))+e.slice(1)),Re(e,o))}function Ae(e,t,i){const o="virtual:flyo-components",a="\0"+o;return{name:"vite-plugin-flyo-components",async resolveId(r){if(r===o)return a},async load(r){if(r===a){const s=[];for(const[c,d]of Object.entries(t)){const v=await this.resolve("/"+e+"/"+d+".astro");v&&s.push(`export { default as ${Ce(c)} } from "${v.id}"`)}let u=null;return i&&(u=await this.resolve("/"+e+"/"+i+".astro")),u?s.push(`export { default as fallback } from "${u.id}"`):s.push('export { default as fallback } from "@flyo/nitro-astro/FallbackComponent.astro"'),s.join(";")}}}}let ke=Symbol("clean"),l=[],Ie=(e,t)=>{let i=[],o={get(){return o.lc||o.listen(()=>{})(),o.value},l:t||0,lc:0,listen(a,r){return o.lc=i.push(a,r||o.l)/2,()=>{let s=i.indexOf(a);~s&&(i.splice(s,2),--o.lc||o.off())}},notify(a,r){let s=!l.length;for(let u=0;u<i.length;u+=2)l.push(i[u],i[u+1],o.value,a,r);if(s){for(let u=0;u<l.length;u+=5){let c;for(let d=u+1;!c&&(d+=5)<l.length;)l[d]<l[u+1]&&(c=l.push(l[u],l[u+1],l[u+2],l[u+3],l[u+4]));c||l[u](l[u+2],l[u+3],l[u+4])}l.length=0}},off(){},set(a){let r=o.value;r!==a&&(o.value=a,o.notify(r))},subscribe(a,r){let s=o.listen(a,r);return a(o.value),s},value:e};return process.env.NODE_ENV!=="production"&&(o[ke]=()=>{i=[],o.lc=0,o.off()}),o};function y(){return globalThis.flyoNitroInstance||console.error("The Flyo Typescript Configuration has not been initialized correctly"),globalThis.flyoNitroInstance}function L(){return new pe(y())}const b=Ie(!1);async function Se(){return b.get()||b.set(await L().config()),b.get()}function Te(){return new ye(y())}function je(){return new he(y())}function Pe(){return new ge(y())}function Ue(){return new ve(y())}function Le(){return new me(y())}function xe(e){return{"data-flyo-block-uid":e.uid}}function Ke(e){const t={accessToken:!1,liveEdit:!1,fallbackComponent:null,componentsDir:"src/components/flyo",...e};return t.liveEdit==="true"?t.liveEdit=!0:t.liveEdit==="false"&&(t.liveEdit=!1),{name:"@flyo/nitro-astro",hooks:{"astro:config:setup":({injectScript:i,updateConfig:o,injectRoute:a})=>{a({pattern:"sitemap.xml",entrypoint:"@flyo/nitro-astro/sitemap.ts"}),o({image:{service:{entrypoint:"@flyo/nitro-astro/cdn.ts"}},vite:{plugins:[Ae(e.componentsDir,e.components,e.fallbackComponent)]}}),i("page-ssr",`
            import { Configuration } from '@flyo/nitro-typescript'

            var defaultConfig = new Configuration({
              apiKey: '${t.accessToken}'
            })

            globalThis.flyoNitroInstance = defaultConfig;
          `),t.liveEdit&&i("page",`
              window.addEventListener("message", (event) => {
                if (event.data?.action === 'pageRefresh') {
                    window.location.reload(true);
                }
              })

              function getActualWindow() {
                if (window === window.top) {
                  return window;
                } else if (window.parent) {
                  return window.parent;
                }
                return window;
              }

              window.openBlockInFlyo = function(blockUid) {
                getActualWindow().postMessage({
                    action: 'openEdit',
                    data: JSON.parse(JSON.stringify({item:{uid: blockUid}}))
                }, 'https://flyo.cloud')
              }

              // Find all elements with the 'data-flyo-block-uid' attribute
              const elements = document.querySelectorAll('[data-flyo-block-uid]');

              elements.forEach(element => {
                  element.addEventListener('click', function() {
                      openBlockInFlyo(this.getAttribute('data-flyo-block-uid'))
                  });
              });
            `)}}}}f.default=Ke,f.editableBlock=xe,f.useConfig=Se,f.useConfigApi=L,f.useConfiguration=y,f.useEntitiesApi=Te,f.usePagesApi=je,f.useSearchApi=Pe,f.useSitemapApi=Ue,f.useVersionApi=Le,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
